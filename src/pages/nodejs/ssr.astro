---
import Reveal from '../../layouts/Reveal.astro';
import { RunKitEmbed } from '../../components';
import ReactTemplate from '../../components/NodejsSsr/ReactTemplate.astro';
import ReactSsr from '../../components/NodejsSsr/ReactSsr.astro';
---

<Reveal title="Node.js å‰ç«¯ç»„ä»¶æ¸²æŸ“">
  <section>
    <iconify-icon class="text-[16rem]" icon="logos:react" />
    <h2>æœåŠ¡ç«¯æ¸²æŸ“</h2>
  </section>

  <section>
    <p>React CSR</p>
    <pre><code data-trim data-line-numbers="4-11|13">{`
      const React = require('react');
      const {createRoot} = require('react-dom/client');

      const App = () => {
        const [value, setValue] = React.useState(0);
        return (
          <button onClick={() => setValue(value + 1)}>
            ğŸ‘<sup>{value}</sup>
          </button>
        );
      };

      createRoot(document.getElementById("app"), <App />);
    `}
    </code></pre>
    <p><code>ReactDOM <span class="text-info">.createRoot</span></code></p>
  </section>

  <ReactTemplate />

  <section>
    <p>
      React DOM Hydrate <a
        target="_blank"
        href="https://babeljs.io/repl#?code_lz=MYewdgzgLgBAggBwTAvDAFASlQPhgbwCgYZRJYBtANwEMAbAVwFMAaGCJqANXuYF1UMAEpMawKADoGHAMpQaUJugAMmANzEYAJ04MtYGAB4ARgyhRw7KAE86TFPnwAzcFBkBLAF5MAXDABMAKwAbAC-oTDgAMJ07sAA1g5YuOycPIxKtBkwANQwAIyYoTiAvBuAsjuGEAwIOPhZzKGGAPRVNc2m5uA4GqEahCJiUAAiAPIAshIAFtYAJloKTEIgIFDoMyDADAC2TGCSAOacAKJ2O3sAQtYAkjPoAEQ0SHeYbIaIyE046oRAA"
        ><iconify-icon icon="line-md:cloud-tags-loop" />
      </a>
    </p>
    <RunKitEmbed
      client:visible
      options={{
        mode: 'endpoint',
        preamble: `
          const Koa = require('koa');
          const React = require('react');
          const ReactDOMServer = require('react-dom/server');
        `,
      }}
    >
      <code data-trim
        >{
          `
            const App = () => {
              const [value, setValue] = React.useState(0);
              return <button style={{fontSize: 256}} onClick={() => setValue(value + 1)}>ğŸ‘<sup>{value}</sup></button>;
            };

            new Koa()
              .use(async ctx => {
                ctx.body = \`
                  <script src="https://unpkg.com/react/umd/react.production.min.js"></script>
                  <script src="https://unpkg.com/react-dom/umd/react-dom.production.min.js"></script>
                  <div id="app">\${ReactDOMServer.renderToString(<App />)}</div>
                \`;
              })
              .listen();
        `
        }
      </code>
    </RunKitEmbed>
    <p>
      <code
        >ReactDOM <del class="text-error">.createRoot</del>
        <span class="text-info">.hydrateRoot</span>
      </code>
    </p>
  </section>

  <ReactSsr />

  <section>
    <div class="r-stack">
      <p>SSR vs CSR</p>
      <img
        class="fragment"
        src="https://miro.medium.com/max/1400/1*jJkEQpgZ8waQ5P-W5lhxuQ.png"
      />
      <img
        class="fragment"
        src="https://miro.medium.com/max/1400/1*CRiH0hUGoS3aoZaIY4H2yg.png"
      />
    </div>
  </section>

  <section>
    <h2>Pros</h2>
    <ul>
      <li>
        é¦–å±æ¸²æŸ“
        <div class="text-sm">ç”¨æˆ·ç¬¬ä¸€æ—¶é—´æœ‰å†…å®¹å¯çœ‹, è€Œä¸æ˜¯å¯¹ç€ç©ºç™½é¡µ.</div>
      </li>
      <li>
        æ•°æ®è·å–
        <div class="text-sm">
          åç«¯æå‰å‡†å¤‡å¥½æ•°æ®, ä¸å¿…ç­‰å¾…å‰ç«¯ js è¿è¡Œåå†è°ƒç”¨ API.
        </div>
      </li>
      <li>
        SEO
        <div class="text-sm">æœç´¢å¼•æ“æœ‰ä¸œè¥¿å¯çˆ¬.</div>
      </li>
    </ul>
  </section>
  <section>
    <h2>Cons</h2>
    <ul>
      <li>
        å ç”¨èµ„æº
        <div class="text-sm">
          æœ¬æ¥ static host çš„ app, ç°åœ¨éœ€è¦ node server.
        </div>
      </li>
      <li>
        å¼€å‘å¤æ‚
        <div class="text-sm">
          React SSR æ¦‚å¿µäº§ç”Ÿè¾ƒæ™š, ç¤¾åŒºç”Ÿæ€æ²¡æœ‰å®Œå…¨åšå¥½å‡†å¤‡.
        </div>
      </li>
    </ul>
  </section>
</Reveal>
